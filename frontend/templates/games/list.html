{% extends 'base.html' %}

{% block title %}All Games - Game Top-Up | TOPUPGAMEMOBILE{% endblock %}

{% block meta_description %}Browse our collection of 50+ popular games for instant top-up. PUBG, Mobile Legends, Free Fire, Genshin Impact and more. Fast delivery, secure payment.{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8">
        <!-- Breadcrumb -->
        <nav class="text-sm mb-4" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2">
                <li><a href="/" class="text-dark-400 hover:text-primary-400 transition-colors">Home</a></li>
                <li><i class="fas fa-chevron-right text-dark-600 text-xs"></i></li>
                <li class="text-white">Games</li>
            </ol>
        </nav>

        <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">
            <i class="fas fa-gamepad text-primary-400 mr-2"></i>
            Choose Game to Top-Up
        </h1>
        <p class="text-dark-400">Select the game you want to top-up and proceed to payment</p>
    </div>

    <!-- Search & Filter -->
    <div class="mb-8 p-6 bg-dark-800 rounded-xl border border-dark-700">
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1 relative">
                <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-dark-400"></i>
                <input
                    type="text"
                    id="searchGame"
                    placeholder="Search games..."
                    class="form-input pl-12"
                >
            </div>
            <button class="btn btn-primary px-6">
                <i class="fas fa-search mr-2"></i>
                Search
            </button>
        </div>
    </div>

    <!-- Games Grid -->
    <div id="gamesGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6">
        <!-- Loading state -->
        <div class="col-span-full text-center py-12">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"></div>
            <p class="text-dark-400 mt-4">Loading games...</p>
        </div>
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="hidden text-center py-16">
        <div class="w-24 h-24 bg-dark-800 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="fas fa-inbox text-4xl text-dark-500"></i>
        </div>
        <h3 class="text-xl font-bold text-white mb-2">No Games Found</h3>
        <p class="text-dark-400">Please check back later or try a different search</p>
    </div>
</div>

<!-- Game Card Template -->
<template id="gameCardTemplate">
    <a href="#" class="game-card block group">
        <div class="game-card-image">
            <img class="game-image" src="" alt="" loading="lazy">
            <div class="game-card-overlay"></div>
            <div class="game-status absolute top-3 right-3 px-2 py-1 rounded-full text-xs font-semibold">
                <span class="game-status-text"></span>
            </div>
        </div>
        <div class="game-card-content">
            <h3 class="game-name font-bold text-white mb-1 truncate group-hover:text-primary-400 transition-colors"></h3>
            <p class="game-description text-dark-400 text-sm line-clamp-2"></p>
        </div>
    </a>
</template>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadGames();
});

function loadGames() {
    fetch('/api/games/')
        .then(response => response.json())
        .then(data => {
            const gamesGrid = document.getElementById('gamesGrid');
            const emptyState = document.getElementById('emptyState');
            const template = document.getElementById('gameCardTemplate');

            gamesGrid.innerHTML = '';

            if (data.results && data.results.length > 0) {
                emptyState.classList.add('hidden');

                data.results.forEach(game => {
                    const card = template.content.cloneNode(true);

                    // Set image
                    const img = card.querySelector('.game-image');
                    img.src = game.image || '/static/images/game-placeholder.png';
                    img.alt = game.name;

                    // Set status
                    const statusDiv = card.querySelector('.game-status');
                    const statusText = card.querySelector('.game-status-text');
                    if (game.status === 'active') {
                        statusDiv.classList.add('bg-green-500/90', 'text-white');
                        statusText.textContent = 'Active';
                    } else if (game.status === 'maintenance') {
                        statusDiv.classList.add('bg-yellow-500/90', 'text-white');
                        statusText.textContent = 'Maintenance';
                    } else {
                        statusDiv.classList.add('bg-dark-600/90', 'text-dark-300');
                        statusText.textContent = 'Inactive';
                    }

                    // Set game info
                    card.querySelector('.game-name').textContent = game.name;
                    card.querySelector('.game-description').textContent = game.description || 'Top up now!';

                    // Set link
                    const link = card.querySelector('a');
                    if (game.status === 'active') {
                        link.href = '/games/' + game.slug + '/';
                    } else {
                        link.href = '#';
                        link.classList.add('cursor-not-allowed');
                        link.onclick = (e) => {
                            e.preventDefault();
                            const statusMsg = game.status === 'maintenance' ? 'under maintenance' : 'inactive';
                            window.modal?.warning('Game Unavailable', `This game is currently ${statusMsg}`);
                        };
                    }

                    gamesGrid.appendChild(card);
                });
            } else {
                emptyState.classList.remove('hidden');
            }
        })
        .catch(error => {
            console.error('Error loading games:', error);
            document.getElementById('gamesGrid').innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-2xl text-red-400"></i>
                    </div>
                    <p class="text-dark-400 mb-4">Unable to load games list</p>
                    <button onclick="loadGames()" class="btn btn-primary">
                        <i class="fas fa-redo mr-2"></i>
                        Retry
                    </button>
                </div>
            `;
        });
}

// Search functionality
document.getElementById('searchGame')?.addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const gameCards = document.querySelectorAll('.game-card');

    gameCards.forEach(card => {
        const gameName = card.querySelector('.game-name').textContent.toLowerCase();
        const gameDesc = card.querySelector('.game-description').textContent.toLowerCase();

        if (gameName.includes(searchTerm) || gameDesc.includes(searchTerm)) {
            card.style.display = '';
        } else {
            card.style.display = 'none';
        }
    });
});
</script>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{% endblock %}
